<!DOCTYPE html>
<html lang='en'>
<head>
<!--    <script src="js/jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.min.js
" charset="utf-8"></script>    
-->
    <script src='js/jquery-1.8.2.min.js' type='text/javascript'></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script src="js/d3.v3.min.js" charset="utf-8"></script>
    <script src='js/lodash.js' type='text/javascript'></script>
    <script src='bootstrap3/js/bootstrap.min.js' type='text/javascript'></script>
    <script src='js/colorbrewer.v1.min.js' type='text/javascript'></script>
    <script src="js/missing-data.js" charset="utf-8"></script>
    <script src="js/crossfilter.js" charset="utf-8"></script>
    <script src="js/box.js" charset="utf-8"></script>
    <script src="js/scatter_lm.js" charset="utf-8"></script>    
    <script src="js/hist_cf.js" charset="utf-8"></script>    
    <link rel="stylesheet" type="text/css" href="bootstrap3/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
<!--     <link rel="stylesheet" type="text/css" href="js/jquery-ui-1.10.4.custom/css/ui-lightness/jquery-ui-1.10.4.custom.min.css
">
 -->
<script>
$.getScript('http://davidstutz.github.io/bootstrap-multiselect/js/bootstrap-multiselect.js',function(){
  
  $('.single option').click(function() {
    // only affects options contained within the same optgroup
    // and doesn't include this
    //$(this).siblings().prop('selected', false);
  });
  
});
</script>
</head>
<body>
<div class='container'>
  <div class='row'>
    <div class="col-md-12 chart" id="chart">
    </div>
  </div>
</div>
<script>

var div;
d3.csv('data/beauty.csv', function(error, dat) {

// column_types for beauty.csv
  var dtypes = {
  "tenured": "factor",
  "profnumber": "factor",
  "minority": "factor",
  "age": "integer",
  "beautyf2upper": "integer",
  "beautyflowerdiv": "integer",
  "beautyfupperdiv": "integer",
  "beautym2upper": "integer",
  "beautymlowerdiv": "integer",
  "beautymupperdiv": "integer",
  "btystdave": "numeric",
  "btystdf2u": "numeric",
  "btystdfl": "numeric",
  "btystdfu": "numeric",
  "btystdm2u": "numeric",
  "btystdml": "numeric",
  "btystdmu": "numeric",
  "class1": "factor",
  "class2": "factor",
  "class3": "factor",
  "class4": "factor",
  "class5": "factor",
  "class6": "factor",
  "class7": "factor",
  "class8": "factor",
  "class9": "factor",
  "class10": "factor",
  "class11": "factor",
  "class12": "factor",
  "class13": "factor",
  "class14": "factor",
  "class15": "factor",
  "class16": "factor",
  "class17": "factor",
  "class18": "factor",
  "class19": "factor",
  "class20": "factor",
  "class21": "factor",
  "class22": "factor",
  "class23": "factor",
  "class24": "factor",
  "class25": "factor",
  "class26": "factor",
  "class27": "factor",
  "class28": "factor",
  "class29": "factor",
  "class30": "factor",
  "courseevaluation": "numeric",
  "didevaluation": "integer",
  "female": "factor",
  "formal": "factor",
  "fulldept": "factor",
  "lower": "factor",
  "multipleclass": "factor",
  "nonenglish": "factor",
  "onecredit": "factor",
  "percentevaluating": "numeric",
  "profevaluation": "numeric",
  "students": "integer",
  "tenuretrack": "factor",
  "blkandwhite": "factor",
  "btystdvariance": "numeric",
  "btystdavepos": "numeric",
  "btystdaveneg": "numeric" 
  }
// end dtypes


  dtypes =  _.zipObject(_.keys(dtypes), _.map(_.keys(dtypes), 
    function(d) { 
      return _.contains(['integer', 'numeric'], 
                        dtypes[d]) ? 'numeric': 'factor'}))

  dat.forEach(function(d, i) {
    d._index = i;
    _.map(_.keys(d), function(k) {
      if('numeric' == dtypes[k]){
        d[k] = +d[k]; 
      }
    })
  })
  cf = crossfilter(dat)

  dimension = cf.dimension(function(d) { return d._index})

  div = d3.select('#chart').style('float', 'left')
        
});

var coefs = {  "m1": {
 "Estimate": [ 0.69381, -0.0034277, -0.0068392, 0.91211, -0.016647, 0.0027241 ],
"Std. Error": [ 0.088407, 0.00095362, 0.019132, 0.016332, 0.026061, 0.0070851 ],
"t value": [ 7.8479, -3.5945, -0.35748, 55.849, -0.63878, 0.38448 ],
"Pr(>|t|)": [ 3.0288e-14, 0.00036043, 0.7209, 2.7366e-206, 0.52329, 0.7008 ],
"variable": [ "(Intercept)", "age", "female1", "courseevaluation", "minority1", "btystdvariance" ] 
}, "m2": {
 "Estimate": [ 0.6923, -0.0034646, -0.0062957, 0.91283, 0.0053262 ],
"Std. Error": [ 0.086458, 0.0010092, 0.019366, 0.01631, 0.019758 ],
"t value": [ 8.0073, -3.433, -0.32509, 55.969, 0.26957 ],
"Pr(>|t|)": [ 9.7611e-15, 0.00065119, 0.74526, 6.4408e-207, 0.78761 ],
"variable": [ "(Intercept)", "age", "female1", "courseevaluation", "tenured1" ] 
}, "m3": {
 "Estimate": [ -2.281, 0.084247, -0.86637, -0.51675, 0.20908 ],
"Std. Error": [ 1.0812, 0.012187, 0.21552, 0.53456, 0.54673 ],
"z value": [ -2.1097, 6.9126,  -4.02, -0.96668, 0.38241 ],
"Pr(>|z|)": [ 0.034882, 4.7596e-12, 5.8206e-05, 0.33371, 0.70216 ],
"variable": [ "(Intercept)", "age", "female1", "courseevaluation", "profevaluation" ] 
}  }


var coefsObj = function(coefs, model) {
  m = coefs[model]
  return _.zipObject(_.map(m, 
                  function(d) { return d.variable;}), m)
}
coefs = _.forOwn(coefs, function(v, k, o) {
  var keys = _.keys(v)
  o[k] = _.map(_.range(v['Estimate'].length), function(x) {
    return _.zipObject(keys, _.map(keys, function(t) {
        return v[t][x];
      }))
  })
})
console.log(coefsObj(coefs, 'm1'))

</script>
</body>
</html>
